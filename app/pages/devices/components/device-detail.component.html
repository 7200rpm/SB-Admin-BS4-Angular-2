

<div class="container-fluid" *ngIf="device">
    <div class="row">
        <div class="col-xl-12">
            <h2 class="page-header">
                <button type="button" class="btn btn-primary" (click)="goBack()">Back</button>
                <button type="button" class="btn btn-primary" (click)="save()">Save</button> | <i class="fa fa-barcode"></i> {{device.serial_number}}
            </h2>
            <hr />
        </div>
    </div>
    <div *ngIf="show_timeline" class="row">
        <div class="col-xl-12">
            <div class="card card-block">
                <h3>Event Timeline</h3>
                <ng-vis [data]="time_data" (visSelect)="onVisSelect($event)"></ng-vis>
                <div *ngIf=selected_event>
                    <div class="row">
                        <div class="col-xs-4">
                            <b>Event:</b> {{selected_event.event}}
                        </div>
                        <div class="col-xs-4">
                            <b>Data:</b> {{selected_event.data}}
                        </div>
                        <div class="col-xs-4">
                            <b>Timestamp:</b> {{selected_event.published_at}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xl-4">
            <div *ngIf="submitted" class="card card-primary card-inverse">
                <div class="card-header card-primary">
                    <h3>Device</h3>
                </div>
                <div class="card-block bg-white">
                    <div class="table-responsive">
                        <table class="table">
                            <tbody>
                                <tr *ngIf="device.nickname">
                                    <th>Nickname</th>
                                    <td>{{device.nickname}}</td>
                                </tr>
                                <tr>
                                    <th>Serial Number</th>
                                    <td>{{device.serial_number}}</td>
                                </tr>
                                <tr>
                                    <th>Particle ID</th>
                                    <td>{{device.particleID}}</td>
                                </tr>
                                <tr>
                                    <th>Hardware Revision</th>
                                    <td>{{device.hardware_revision}}</td>
                                </tr>
                                <tr *ngIf="device.notes">
                                    <td colspan="2"><b>Notes:</b> {{device.notes}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary" (click)="submitted=false">Edit Information</button>
                    <hr />
                    <button *ngIf="!delete_warning" class="btn btn-danger" (click)="delete_warning=true">Delete Device</button>
                    <div *ngIf="delete_warning">
                        <div class="row">
                            <div class="col-xs-6">Are you sure you want to delete the device?</div>
                            <div class="col-xs-6 pull-right">
                                <button class="btn btn-danger" (click)="delete()">Yes</button>
                                <button class="btn btn-warning" (click)="delete_warning=false">No</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf="!submitted" class="card card-primary card-inverse">
                <div class="card-header card-primary">
                    <h3>Update</h3>
                </div>
                <div class="card-block bg-white">
                    <form role="form" (ngSubmit)="onSubmit()">
                        <fieldset class="form-group">
                            <label>Nickname</label>
                            <input class="form-control" name="device-nickname" value="{{device.nickname}}" [(ngModel)]="device.nickname">
                        </fieldset>
                        <fieldset class="form-group">
                            <label>Serial Number</label>
                            <input class="form-control" name="device-serial_number" value="{{device.serial_number}}" [(ngModel)]="device.serial_number">
                        </fieldset>
                        <fieldset class="form-group">
                            <label>Particle ID</label>
                            <input class="form-control" name="device-particleID" value="{{device.particleID}}" [(ngModel)]="device.particleID">
                        </fieldset>
                        <fieldset class="form-group">
                            <label>Hardware Revision</label>
                            <input class="form-control" name="device-hardware_revision" value="{{device.hardware_revision}}" [(ngModel)]="device.hardware_revision">
                        </fieldset>
                        <fieldset class="form-group">
                            <label>Notes</label>
                            <textarea class="form-control" name="device-notes" rows="3" value="{{device.notes}}" [(ngModel)]="device.notes"></textarea>
                        </fieldset>
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="reset" class="btn btn-secondary">Reset</button>
                    </form>
                </div>
            </div>
            <div *ngIf=device.orderID class="card card-success card-inverse">
                <div class="card-header card-success">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-user fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-xs-right">
                            <div>
                                <h4>Shipped to
                                    <br />{{device.order.name}}</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer card-green">
                    <a class="text-success" href="dashboard/customer/{{device.orderID}}">
                        <span class="pull-xs-left">View Details</span>
                        <span class="pull-xs-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </a>
                </div>
            </div>
            <div *ngIf=!device.order class="card card-warning card-inverse">
                <div class="card-header card-warning">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-home fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-xs-right">
                            <div>
                                <h3>In Stock</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-8">
            <div class="card card-block">
                <h3>Telemetry
                    <button *ngIf="!show_timeline && !loading_timeline" type="button" class="btn btn-primary" (click)="LoadTimeline()">Load Timeline</button>
                    <button *ngIf="loading_timeline" type="button" class="btn btn-warning"><i>Loading Timeline...</i></button>
                    <button *ngIf="show_timeline && !loading_timeline" type="button" class="btn btn-danger" (click)="show_timeline=false">Close Timeline</button>
                </h3>
                <table-telemetry-demo [data_in]=device.telemetry>
                </table-telemetry-demo>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xl-12">
            <div class="card card-block">
                <div class="row">
                    <div class="col-xl-6">
                        <h3>Power Events</h3>
                        <table-device-power [data_in]=device.power_events>
                        </table-device-power>
                    </div>
                    <div class="col-xl-6">
                        <div *ngIf="selected_power_event">
                            <h4>{{selected_power_event.type}}</h4> {{selected_power_event.start_time}} - {{selected_power_event.end_time}}
                        </div>
                        <div *ngIf="!selected_power_event">
                            <h4>Select a power event</h4>
                        </div>
                        <iframe src="http://wakeapi.azurewebsites.net/charts/voltage.php" style="border:none" width="100%" height="800"></iframe>
                        <button type="button" class="btn btn-primary" (click)="onPreviousPower()">Previous</button>
                        <button type="button" class="btn btn-primary" (click)="onNextPower()">Next</button>
                        <a href="#" target="_blank" class="btn btn-warning">Export as PNG</a>
                    </div>
                </div>
            </div>
            <div class="card card-block">
                <h3>Scans</h3>
                <div class="row">
                    <div class="col-xl-6">
                        <table-device-scan [data_in]=device.scans (rowClicked)="onScanSelect($event)">
                        </table-device-scan>
                    </div>
                    <div class="col-xl-6">
                        <!-- (chartHover)="chartHovered($event)" -->
                        <google-chart #yourchart id="mychart" chartType="LineChart" [chartOptions]="chartOptions" [chartData]="chartData" [(imageUri)]="scanImageUri" style="width: 100%"></google-chart>
                        <!-- <base-chart style="display: block; width: 100%; height: 100%" class="chart" [data]="chartData" [labels]="chartLabels" [chartType]="chartType" (chartClick)="chartClicked($event)"></base-chart> -->
                        <button type="button" class="btn btn-primary" (click)="onPreviousScan()">Previous</button>
                        <button type="button" class="btn btn-primary" (click)="onNextScan()">Next</button>
                        <a href="{{scanImageUri}}" target="_blank" class="btn btn-warning">Export as PNG</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
